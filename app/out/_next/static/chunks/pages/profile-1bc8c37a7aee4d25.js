(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{9134:function(e,r,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return a(1406)}])},1406:function(e,r,a){"use strict";a.r(r);var t=a(5893),l=a(1701),s=a(9822),o=a(9611),i=a(1163),d=a(7294),n=a(6650),c=a(751),u=a(5352),m=a(2947);r.default=function(){let e=(0,i.useRouter)(),{new:r}=e.query,[{user:a},p]=(0,l.C4)(),[g,x]=(0,d.useState)(!1),[h,f]=(0,d.useState)(null),[y,b]=(0,d.useState)(""),[v,k]=(0,d.useState)(!1),[N,w]=(0,d.useState)(!1),j=(0,d.useRef)(null),[C,U]=(0,d.useState)({userName:"",description:""});(0,d.useEffect)(()=>{a&&(U({userName:(null==a?void 0:a.userName)||"",description:(null==a?void 0:a.description)||""}),!h&&a.avatar&&f(a.avatar),x(!0))},[a]),(0,d.useEffect)(()=>()=>{h&&h.startsWith("blob:")&&URL.revokeObjectURL(h)},[h]),(0,d.useEffect)(()=>{let e=setTimeout(()=>{let e=C.userName!==((null==a?void 0:a.userName)||"")||C.description!==((null==a?void 0:a.description)||"")||h&&h.startsWith("blob:");w(e)},100);return()=>clearTimeout(e)},[C,a,h]);let E=async e=>{var r;let t=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!t)return;if(!["image/gif","image/jpeg","image/png","image/webp"].includes(t.type)){b("Please upload a valid image (JPEG, PNG, GIF, or WebP)"),e.target.value=null;return}b("");let l=URL.createObjectURL(t);f(l);let o=m.Am.loading("Uploading avatar...");try{let e;let r="users/".concat(null==a?void 0:a.uid,"/avatar/0"),i=(0,n.iH)(c.tO,r);if(await (0,n.KV)(i,t),null==a?void 0:a.avatar){let r=new URL(a.avatar);r.searchParams.set("updated",Date.now()),r.searchParams.has("alt")||r.searchParams.set("alt","media"),e=r.toString()}else e="https://firebasestorage.googleapis.com/v0/b/".concat(c.tO.app.options.storageBucket,"/o/").concat(encodeURIComponent("users/".concat(null==a?void 0:a.uid,"/avatar/0")),"?alt=media&updated=").concat(Date.now());p({type:s.J.SET_USER,user:{...a,avatar:e}}),URL.revokeObjectURL(l),f(e),m.Am.update(o,{render:"Avatar updated successfully!",type:"success",isLoading:!1,autoClose:3e3})}catch(e){console.error("Error uploading image:",e),f((null==a?void 0:a.avatar)||null),URL.revokeObjectURL(l),m.Am.update(o,{render:"Failed to update avatar. Please try again.",type:"error",isLoading:!1,autoClose:5e3})}finally{e.target.value=""}},P=e=>{E(e)},R=e=>{U({...C,[e.target.name]:e.target.value}),"userName"===e.target.name&&y&&b("")},_=async()=>{var t,l,i;if(!N){m.Am.info("No changes to save.");return}if(!C.userName.trim()){b("Username is required"),null===(t=j.current)||void 0===t||t.focus(),null===(l=j.current)||void 0===l||l.scrollIntoView({behavior:"smooth",block:"center"});return}k(!0),b("");try{let t=await (0,o.av)({...C});if(t.userNameError){b("Username is already taken"),null===(i=j.current)||void 0===i||i.focus(),k(!1);return}p({type:s.J.SET_USER,user:{...a,...C}}),m.Am.success("Profile updated successfully!"),r&&e.push("/")}catch(e){console.error("Profile update error:",e),b("An error occurred while updating profile. Please try again.")}finally{k(!1)}};return(0,t.jsx)("div",{className:"min-h-screen bg-neutral-light dark:bg-neutral-dark flex items-center justify-center p-4 md:p-8",children:g&&(0,t.jsxs)("div",{className:"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-primary-darker p-6 text-center",children:[" ",(0,t.jsx)("h2",{className:"text-2xl md:text-3xl font-bold text-white",children:(null==a?void 0:a.userName)?"Update Your Profile":"Complete Your Profile"}),(0,t.jsx)("p",{className:"mt-2 text-blue-100",children:(null==a?void 0:a.userName)?"Make changes to your profile information":"Let's get to know you better"})]}),(0,t.jsxs)("div",{className:"p-6 md:p-8",children:[y&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/30 border-l-4 border-red-500 dark:border-red-700 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:y})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(u.Z,{src:h,email:null==a?void 0:a.email,editable:!0,onFileChange:P,size:160})}),(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"userName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Username ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"@"})}),(0,t.jsx)("input",{ref:j,type:"text",name:"userName",id:"userName",value:C.userName,onChange:R,autoComplete:"username",className:"block w-full pl-8 pr-3 py-3 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white rounded-lg focus:ring-2 focus:ring-primary-darker focus:border-primary-darker transition",placeholder:"yourusername"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),(0,t.jsx)("input",{type:"email",name:"email",id:"email",value:(null==a?void 0:a.email)||"",readOnly:!0,autoComplete:"email",className:"block w-full px-4 py-3 border border-gray-300 bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400 rounded-lg focus:ring-0 focus:border-gray-300 cursor-not-allowed transition",placeholder:"your.email@example.com"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"About You"}),(0,t.jsx)("textarea",{name:"description",id:"description",rows:3,value:C.description,onChange:R,autoComplete:"off",className:"block w-full px-4 py-3 border border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white rounded-lg focus:ring-2 focus:ring-primary-darker focus:border-primary-darker transition",placeholder:"Tell us about yourself..."})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[(0,t.jsx)("button",{onClick:_,disabled:v||!N,className:"flex-1 px-6 py-3 rounded-lg font-medium text-white transition flex items-center justify-center ".concat(v||!N?"bg-primary/70 dark:bg-primary-darker/50 text-white/70 dark:text-white/50 cursor-not-allowed":"bg-primary hover:bg-primary-darker text-white dark:text-white shadow-md hover:shadow-lg dark:bg-primary-darker dark:hover:bg-primary"),children:v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Profile"}),(0,t.jsx)("button",{onClick:()=>e.push("/"),disabled:!!r,className:"flex-1 px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition ".concat(r&&"cursor-not-allowed opacity-50"),children:"Cancel"})]})]})]})]})})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9134)}),_N_E=e.O()}]);