"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[772],{7772:function(e,s,t){var r=t(5893),a=t(1701),l=t(1664),d=t.n(l),c=t(7294),p=t(751);t(6100);var n=t(7004),m=t(6907);let i=(0,n.V1)(p.wk,"approveOrder"),x=(0,n.V1)(p.wk,"rejectOrder");s.Z=function(e){let{pageTitle:s,userRole:t,emptyOrdersMessage:l,upcomingOrders:p=[],pastOrders:n=[]}=e,[{userInfo:o}]=(0,a.C4)(),[y,h]=(0,c.useState)(null),[u,g]=(0,c.useState)({text:"",type:""}),[j,N]=(0,c.useState)({}),[v,b]=(0,c.useState)(p),[f,w]=(0,c.useState)(n),k=(0,c.useMemo)(()=>[...p,...n],[p,n]);(0,c.useEffect)(()=>{b(p)},[p]),(0,c.useEffect)(()=>{w(n)},[n]),(0,c.useEffect)(()=>{let e=k.map(e=>e.serviceDate).filter(e=>e);if(0===e.length){N({});return}let s=[...new Set(e.map(e=>new Date(e).getFullYear()))];s.length>0&&(0,m.vA)(s);let t=async()=>{let s={};for(let t of e)if(t&&!s.hasOwnProperty(t))try{let e=new Date(t).toISOString().split("T")[0];s[e]=await (0,m.ib)(e)}catch(e){console.error("Error processing date for holiday check:",t,e),s[t]=!1}N(e=>({...e,...s}))};t()},[k]);let _=e=>{let s="Processing";e.status?s=e.status:"buyer"===t&&e.isCompleted?s="Completed":"seller"===t&&e.isCompleted&&(s="Completed");let a=s.toLowerCase();switch(a){case"pending_seller_approval":return"seller"===t?(0,r.jsx)("span",{className:"text-yellow-500",children:"Pending Your Approval"}):(0,r.jsx)("span",{className:"text-yellow-600 dark:text-yellow-400",children:"Pending Seller Approval"});case"seller_approved_pending_capture":return"seller"===t?(0,r.jsx)("span",{className:"text-blue-500",children:"Processing Payment"}):(0,r.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:"Order Approved, Processing Payment"});case"approved_by_seller":return"buyer"===t?(0,r.jsx)("span",{className:"text-blue-600 dark:text-blue-400",children:"Order Approved by Seller"}):(0,r.jsx)("span",{className:"text-green-500",children:"Order Active (Payment Confirmed)"});case"payment_successful":return"seller"===t?(0,r.jsx)("span",{className:"text-green-500 font-semibold",children:"Order Active (Payment Confirmed)"}):(0,r.jsx)("span",{className:"text-green-500 dark:text-green-400",children:"Order Confirmed, Awaiting Fulfillment"});case"payment_failed":var l,d,c;let p="Payment Failed";return(null===(l=e.stripeError)||void 0===l?void 0:l.code)?p+=" (Code: ".concat(e.stripeError.code,")"):(null===(d=e.stripeError)||void 0===d?void 0:d.message)&&(p+=" (Message: ".concat(e.stripeError.message.substring(0,30),"...)")),(0,r.jsx)("span",{className:"text-red-700 dark:text-red-500",title:(null===(c=e.stripeError)||void 0===c?void 0:c.message)||"Payment processing failed.",children:p});case"rejected_by_seller":return(0,r.jsxs)("span",{className:"text-red-600 dark:text-red-400",children:["seller"===t?"Order Rejected":"Order Rejected by Seller",e.sellerNotes&&(0,r.jsxs)("div",{className:"text-xs italic",children:["Reason: ",e.sellerNotes]})]});case"completed":return(0,r.jsx)("span",{className:"text-green-600 dark:text-green-400",children:"Order Completed"});case"canceled_by_system":return(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Order Canceled"});case"processing":return(0,r.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Processing..."});default:return(0,r.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:s||("seller"===t?"Status Unknown":"Processing...")})}},A=async e=>{if("seller"===t){h(e),g({text:"",type:""});try{b(s=>s.map(s=>s.id===e?{...s,status:"seller_approved_pending_capture"}:s)),w(s=>s.map(s=>s.id===e?{...s,status:"seller_approved_pending_capture"}:s)),await i({orderId:e}),g({text:"Order approval initiated. Payment processing.",type:"success"})}catch(e){console.error("Error approving order:",e),g({text:"Failed to approve order: ".concat(e.message),type:"error"})}finally{h(null)}}},S=async e=>{if("seller"!==t)return;let s=window.prompt("Please provide a reason for rejection (optional):");if(null!==s){h(e),g({text:"",type:""});try{await x({orderId:e,rejectionReason:s||""}),b(t=>t.map(t=>t.id===e?{...t,status:"rejected_by_seller",sellerNotes:s||""}:t)),w(t=>t.map(t=>t.id===e?{...t,status:"rejected_by_seller",sellerNotes:s||""}:t)),g({text:"Order rejected successfully.",type:"success"})}catch(e){console.error("Error rejecting order:",e),g({text:"Failed to reject order: ".concat(e.message),type:"error"})}finally{h(null)}}},O=e=>"seller"===t&&e.status&&"pending_seller"===e.status.toLowerCase()?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>A(e.id),disabled:y===e.id,className:"font-medium text-green-600 hover:text-green-800 disabled:opacity-50 mr-2",children:y===e.id?"Approving...":"Approve"}),(0,r.jsx)("button",{onClick:()=>S(e.id),disabled:y===e.id,className:"font-medium text-red-600 hover:text-red-800 disabled:opacity-50",children:y===e.id?"Rejecting...":"Reject"})]}):null,C=(e,s)=>0===e.length?(0,r.jsxs)("div",{className:"my-6",children:[(0,r.jsx)("h4",{className:"text-lg font-semibold dark:text-white mb-3",children:s}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No orders in this category."})]}):(0,r.jsxs)("div",{className:"my-8",children:[(0,r.jsx)("h4",{className:"text-lg sm:text-xl font-semibold dark:text-white mb-4",children:s}),(0,r.jsx)("div",{className:"relative overflow-x-auto shadow-md sm:rounded-lg",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Order Id"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"seller"===t?"Service Title":"Name"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Category"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Price"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Duration"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Service Date"})," ","seller"===t&&(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Ordered By (ID)"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Order Date"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Status"}),"seller"===t&&(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Actions"}),(0,r.jsx)("th",{scope:"col",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:"Send Message"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>{var s,a;return(0,r.jsxs)("tr",{className:"bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,r.jsx)("th",{scope:"row",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4 whitespace-nowrap dark:text-white",children:e.id}),(0,r.jsx)("th",{scope:"row",className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4 font-medium whitespace-nowrap dark:text-white",children:e.serviceTitle||"N/A"}),(0,r.jsx)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:e.category||"N/A"}),(0,r.jsxs)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:["$",e.price]}),(0,r.jsxs)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:[e.durationHours||"N/A"," Hours"]}),(0,r.jsx)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:e.serviceDate?(()=>{let s=new Date(e.serviceDate).toISOString().split("T")[0],t=new Date(e.serviceDate).toLocaleDateString(),a=j[s];return(0,r.jsxs)(r.Fragment,{children:[t,a&&(0,r.jsx)("span",{className:"text-xs text-red-500 ml-1",children:"(Holiday)"})]})})():"N/A"})," ","seller"===t&&(0,r.jsx)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:e.buyerDisplayName||e.buyerId||"N/A"}),(0,r.jsx)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:(null===(s=e.createdAt)||void 0===s?void 0:s.seconds)?new Date(1e3*e.createdAt.seconds).toLocaleDateString():(null===(a=e.createdAt)||void 0===a?void 0:a._seconds)?new Date(1e3*e.createdAt._seconds).toLocaleDateString():"number"==typeof e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}),(0,r.jsx)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:_(e)}),"seller"===t&&(0,r.jsx)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4 whitespace-nowrap",children:O(e)}),(0,r.jsx)("td",{className:"px-3 py-2 sm:px-4 sm:py-3 md:px-6 md:py-4",children:e.status&&"approved_by_seller"===e.status.toLowerCase()||"payment_successful"===e.status.toLowerCase()?(0,r.jsx)(d(),{href:"/".concat("buyer"===t?"buyer":"seller","/messages/").concat(e.id),className:"font-medium text-blue-600 dark:text-blue-400 hover:underline",children:"Send"}):(0,r.jsx)("span",{className:"text-gray-400 dark:text-gray-500",children:"-"})})]},e.id)})})]})})]});return(0,r.jsxs)("div",{className:"min-h-[80vh] my-6 sm:my-10 px-4 sm:px-6 md:px-8",children:[(0,r.jsx)("h3",{className:"text-xl sm:text-2xl font-semibold dark:text-white mb-4 sm:mb-6",children:s}),"seller"===t&&u.text&&(0,r.jsx)("div",{className:"p-4 mt-4 mb-4 text-sm rounded-lg ".concat("error"===u.type?"bg-red-100 text-red-700 dark:bg-red-200 dark:text-red-800":"bg-green-100 text-green-700 dark:bg-green-200 dark:text-green-800"),role:"alert",children:u.text}),C(v,"Upcoming Orders"),C(f,"Past Orders"),0===v.length&&0===f.length&&(0,r.jsx)("div",{className:"text-center my-10 text-xl text-gray-500 dark:text-gray-300",children:l||"You have no orders yet."})]})}}}]);