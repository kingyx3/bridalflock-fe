(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[899],{3462:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/seller/orders",function(){return r(8097)}])},8097:function(e,t,r){"use strict";r.r(t);var s=r(5893),a=r(1701),d=r(7294),n=r(751),o=r(6100),i=r(7772);t.default=function(){let[{user:e}]=(0,a.C4)(),[t,r]=(0,d.useState)({text:"",type:""}),[l,c]=(0,d.useState)(0),[u,v]=(0,d.useState)([]),[x,f]=(0,d.useState)(!1),[h,p]=(0,d.useState)(!0),[y,g]=(0,d.useState)(0),[m,D]=(0,d.useState)([]),[b,w]=(0,d.useState)([]),_=async s=>{if(!(null==e?void 0:e.uid)||s>0&&!h){f(!1);return}f(!0),t.text&&"error"===t.type&&r({text:"",type:""});try{let t=(0,o.JU)(n.db,"users",e.uid,"userSellerOrders",String(s)),r=await (0,o.QT)(t);if(r.exists()){let e=r.data(),t=Object.values(e).filter(e=>e&&!e.deletedAt&&"object"==typeof e);t.sort((e,t)=>{var r,s,a,d;let n=(null===(r=e.createdAt)||void 0===r?void 0:r.seconds)||(null===(s=e.createdAt)||void 0===s?void 0:s._seconds)||("number"==typeof e.createdAt?e.createdAt:0),o=(null===(a=t.createdAt)||void 0===a?void 0:a.seconds)||(null===(d=t.createdAt)||void 0===d?void 0:d._seconds)||("number"==typeof t.createdAt?t.createdAt:0);return o-n}),0===s?v([...t]):v(e=>{let r=new Set(e.map(e=>e.id)),s=t.filter(e=>!r.has(e.id));return[...e,...s]}),c(s),s+1>=Math.ceil(y/100)||0===y||t.length<100?p(!1):p(!0)}else 0===s&&v([]),p(!1)}catch(e){console.error("Error fetching seller order group ".concat(s,":"),e),r({text:"Error fetching page ".concat(s+1,". Details: ").concat(e.message),type:"error"})}finally{f(!1)}},N=async()=>{if(null==e?void 0:e.uid){f(!0),t.text&&r({text:"",type:""});try{let t=(0,o.JU)(n.db,"users",e.uid,"userSellerOrdersMetadata","summary"),r=await (0,o.QT)(t),s=0;r.exists()?(s=r.data().totalOrdersCount||0,g(s)):g(0),v([]),c(0),s>0?(p(!0),await _(0)):p(!1)}catch(e){console.error("Error fetching initial seller order data:",e),r({text:"Failed to load initial order data. Details: ".concat(e.message),type:"error"}),p(!1),g(0)}finally{f(!1)}}};return(0,d.useEffect)(()=>{(null==e?void 0:e.uid)&&N()},[null==e?void 0:e.uid]),(0,d.useEffect)(()=>{let e=new Date;e.setHours(0,0,0,0);let t=[],r=[];u.forEach(s=>{let a;if(s.serviceDate&&"string"==typeof s.serviceDate)a=new Date(s.serviceDate);else if(s.serviceDate&&s.serviceDate.seconds)a=new Date(1e3*s.serviceDate.seconds);else{r.push(s);return}a.setHours(0,0,0,0),a>=e?t.push(s):r.push(s)}),t.sort((e,t)=>{var r,s;let a=new Date((null===(r=e.serviceDate)||void 0===r?void 0:r.seconds)?1e3*e.serviceDate.seconds:e.serviceDate||0),d=new Date((null===(s=t.serviceDate)||void 0===s?void 0:s.seconds)?1e3*t.serviceDate.seconds:t.serviceDate||0);return a-d}),r.sort((e,t)=>{var r,s;let a=new Date((null===(r=e.serviceDate)||void 0===r?void 0:r.seconds)?1e3*e.serviceDate.seconds:e.serviceDate||0),d=new Date((null===(s=t.serviceDate)||void 0===s?void 0:s.seconds)?1e3*t.serviceDate.seconds:t.serviceDate||0);return d-a}),D(t),w(r)},[u]),(0,s.jsxs)("div",{className:"min-h-[80vh] my-6 sm:my-10 px-4 sm:px-6 md:px-8",children:[t.text&&(0,s.jsx)("div",{className:"p-4 mt-4 mb-4 text-sm rounded-lg ".concat("error"===t.type?"bg-red-100 text-red-700 dark:bg-red-200 dark:text-red-800":"bg-green-100 text-green-700 dark:bg-green-200 dark:text-green-800"),role:"alert",children:t.text}),(0,s.jsx)(i.Z,{pageTitle:"Your Received Orders",userRole:"seller",emptyOrdersMessage:"You have no orders from buyers yet.",upcomingOrders:m,pastOrders:b}),x&&!t.text&&(0,s.jsx)("div",{className:"text-center my-4 dark:text-white",children:"Loading orders..."}),!x&&h&&y>0&&!t.text&&(0,s.jsx)("div",{className:"flex justify-center my-6",children:(0,s.jsx)("button",{onClick:()=>_(l+1),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",disabled:x,children:"Load More Orders"})}),!x&&!h&&u.length>0&&!t.text&&(0,s.jsx)("div",{className:"text-center my-4 text-gray-500 dark:text-gray-400",children:"No more orders to load."}),0===u.length&&!x&&!t.text&&null]})}}},function(e){e.O(0,[772,774,888,179],function(){return e(e.s=3462)}),_N_E=e.O()}]);