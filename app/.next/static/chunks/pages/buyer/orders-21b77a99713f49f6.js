(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[758],{5085:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/buyer/orders",function(){return r(5260)}])},5260:function(e,t,r){"use strict";r.r(t);var s=r(5893),d=r(1701),o=r(7294),n=r(751),a=r(6100),i=r(7772);t.default=function(){let[{user:e}]=(0,d.C4)(),[t,r]=(0,o.useState)(0),[c,l]=(0,o.useState)([]),[u,v]=(0,o.useState)(!0),[f,h]=(0,o.useState)(!1),[p,D]=(0,o.useState)(!0),[m,x]=(0,o.useState)(0),[g,y]=(0,o.useState)([]),[b,w]=(0,o.useState)([]),_=(0,o.useCallback)((e,t)=>{let r=Object.entries(e).filter(e=>{let[t,r]=e;return t.startsWith("item_")&&"updatedAt"!==t&&r&&!r.deletedAt&&"object"==typeof r}).map(e=>{let[t,r]=e;return r}).sort((e,t)=>{var r,s,d,o;return((null===(r=t.createdAt)||void 0===r?void 0:r.seconds)||(null===(s=t.createdAt)||void 0===s?void 0:s._seconds)||t.createdAt||0)-((null===(d=e.createdAt)||void 0===d?void 0:d.seconds)||(null===(o=e.createdAt)||void 0===o?void 0:o._seconds)||e.createdAt||0)});l(e=>{let s=e.filter(e=>e.groupIndex!==t),d=[...s,...r.map(e=>({...e,groupIndex:t}))];return d.sort((e,t)=>{var r,s,d,o;return((null===(r=t.createdAt)||void 0===r?void 0:r.seconds)||(null===(s=t.createdAt)||void 0===s?void 0:s._seconds)||t.createdAt||0)-((null===(d=e.createdAt)||void 0===d?void 0:d.seconds)||(null===(o=e.createdAt)||void 0===o?void 0:o._seconds)||e.createdAt||0)}),d})},[]);(0,o.useEffect)(()=>{let e=new Date;e.setHours(0,0,0,0);let t=[],r=[];c.forEach(s=>{let d;if(s.serviceDate&&"string"==typeof s.serviceDate)d=new Date(s.serviceDate);else if(s.serviceDate&&s.serviceDate.seconds)d=new Date(1e3*s.serviceDate.seconds);else{r.push(s);return}d.setHours(0,0,0,0),d>=e?t.push(s):r.push(s)}),t.sort((e,t)=>{var r,s;let d=new Date((null===(r=e.serviceDate)||void 0===r?void 0:r.seconds)?1e3*e.serviceDate.seconds:e.serviceDate||0),o=new Date((null===(s=t.serviceDate)||void 0===s?void 0:s.seconds)?1e3*t.serviceDate.seconds:t.serviceDate||0);return d-o}),r.sort((e,t)=>{var r,s;let d=new Date((null===(r=e.serviceDate)||void 0===r?void 0:r.seconds)?1e3*e.serviceDate.seconds:e.serviceDate||0),o=new Date((null===(s=t.serviceDate)||void 0===s?void 0:s.seconds)?1e3*t.serviceDate.seconds:t.serviceDate||0);return o-d}),y(t),w(r)},[c]),(0,o.useEffect)(()=>{if(!(null==e?void 0:e.uid)){l([]),v(!1);return}v(!0);let r=(0,a.JU)(n.db,"users",e.uid,"userOrdersMetadata","summary"),s=(0,a.cf)(r,e=>{if(e.exists()){let r=e.data().totalOrdersCount||0;x(r),D(t<Math.ceil(r/100)-1)}else x(0),D(!1)},e=>{console.error("Error listening to metadata:",e),x(0),D(!1)}),d=(0,a.JU)(n.db,"users",e.uid,"userOrders","0"),o=(0,a.cf)(d,e=>{e.exists()?_(e.data(),0):(l(e=>e.filter(e=>0!==e.groupIndex)),0===m&&D(!1)),v(!1)},e=>{console.error("Error listening to order group 0:",e),v(!1)});return()=>{s(),o()}},[null==e?void 0:e.uid,_,m,t]);let A=async()=>{if(!(null==e?void 0:e.uid)||f||!p)return;h(!0);let s=t+1;try{let t=(0,a.JU)(n.db,"users",e.uid,"userOrders",String(s)),d=await (0,a.QT)(t);d.exists()?(_(d.data(),s),r(s),D(s<Math.ceil(m/100)-1)):D(!1)}catch(e){console.error("Error fetching order group ".concat(s,":"),e),D(!1)}finally{h(!1)}};return(0,s.jsxs)("div",{className:"min-h-[80vh] my-6 sm:my-10 px-4 sm:px-6 md:px-8",children:[u&&(0,s.jsx)("div",{className:"text-center my-4 dark:text-white",children:"Loading recent orders..."}),(0,s.jsx)(i.Z,{pageTitle:"Your Orders",userRole:"buyer",emptyOrdersMessage:"You have no orders yet.",upcomingOrders:g,pastOrders:b}),!u&&c.length>0&&p&&(0,s.jsx)("div",{className:"flex justify-center my-6",children:(0,s.jsx)("button",{onClick:A,className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",disabled:f,children:f?"Loading...":"Load More Orders"})}),!u&&!f&&!p&&c.length>0&&(0,s.jsx)("div",{className:"text-center my-4 text-gray-500 dark:text-gray-400",children:"No more older orders to load."}),0===c.length&&!u&&!f&&null]})}}},function(e){e.O(0,[772,774,888,179],function(){return e(e.s=5085)}),_N_E=e.O()}]);